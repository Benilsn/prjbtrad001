{#fragment id=footer}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
      /* ----------------------------------
       * 1. Initialize Bootstrap Tooltips
       * ---------------------------------- */
      fetchWallet();
      setInterval(fetchWallet, 5000);
      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });

    async function fetchWallet() {
      try {
        const response = await fetch('/refresh-wallet');
        if (!response.ok) throw new Error("Failed to fetch wallet balance");

        const data = await response.text();
        console.log("Fetched wallet:", data);

        const walletElement = document.getElementById('wallet-balance');
        walletElement.textContent = data;
      } catch (error) {
        console.error('Error fetching wallet:', error);
      }
    }

      /* ----------------------------------
       * 2. Fetch and Update Prices
       * ---------------------------------- */
      async function fetchPrices() {
        try {
          const symbols = "{workingSymbols ?: ''}".split(',');
          const params = new URLSearchParams({
          symbols: JSON.stringify(symbols)
        });

        const response = await fetch('/refresh-data?' + params);
        const data = await response.json();
        console.log("Fetched data:", data);

        for (const crypto of data) {
          const symbol = crypto.symbol;
          const price = crypto.price;
          const lastUpdated = crypto.lastUpdated;

          const labelEl = document.getElementById(symbol + '-label');
          const priceEl = document.getElementById(symbol + '-price');
          const updatedEl = document.getElementById(symbol + '-updated');

          if (labelEl && priceEl && updatedEl) {
            labelEl.textContent = 'Price for ' + symbol;
            priceEl.textContent = price;
            updatedEl.textContent = lastUpdated;
          } else {
            console.warn("No element found for symbol: " + symbol);
          }
        }
      } catch (error) {
        console.error('Error fetching prices:', error);
      }
    }

    if (window.location.pathname === "/") {
      fetchPrices();
      setInterval(fetchPrices, 2000);
    }

    /* ----------------------------------
     * 3. Trade Log Handling + Auto-scroll
     * ---------------------------------- */
    const logContainer = document.getElementById('log-container');
    const logContent = document.getElementById('trade-log-content');

    function scrollToBottom() {
      if (logContainer) {
        logContainer.scrollTop = logContainer.scrollHeight;
      }
    }


    async function refreshTradeLog() {
      try {
        const response = await fetch('/refresh-log-data');
        if (!response.ok) throw new Error('Failed to fetch log data');

        const logData = await response.json();

        if (logContent) {
          logContent.innerHTML = ''; // Clear old entries
          logData.forEach(item => {
            const p = document.createElement('p');
            p.className = 'log-entry';
            p.textContent = item;
            logContent.appendChild(p);
          });

          scrollToBottom();
        }
      } catch (error) {
        console.error('Error fetching trade log:', error);
      }
    }

    refreshTradeLog();
    setInterval(refreshTradeLog, 10000);

    if (logContainer) {
      const observer = new MutationObserver(scrollToBottom);
      observer.observe(logContainer, { childList: true, subtree: true });
    }

    /* ----------------------------------
     * Trade Log Filter
     * ---------------------------------- */
    const logFilter = document.getElementById('log-filter');
    if (logFilter) {
      logFilter.addEventListener('input', function () {
        const query = this.value.toLowerCase();
        const entries = document.querySelectorAll('#trade-log-content .log-entry');

        entries.forEach(entry => {
          const text = entry.textContent.toLowerCase();
          if (text.includes(query)) {
            entry.classList.remove('hidden-log');
          } else {
            entry.classList.add('hidden-log');
          }
        });
      });
    }

    /* ----------------------------------
     * Symbol Prefix for Purchase Amount
     * ---------------------------------- */
    const strategySelect = document.querySelector('select[name="purchaseStrategy"]');
    const amountSymbol = document.getElementById('amountSymbol');

    if (strategySelect && amountSymbol) {
      function updateSymbol() {
        const strategy = strategySelect.value;
        amountSymbol.textContent = strategy === 'PERCENTAGE' ? '%' : '$';
      }

      strategySelect.addEventListener('change', updateSymbol);
      updateSymbol(); // Initial set
    }
  });

    window.onload = function() {
        if (new URLSearchParams(window.location.search).has('message')) {
            setTimeout(function() {
                window.history.replaceState({}, document.title, window.location.pathname);
            }, 2000);
        }
    }

</script>




<footer class="cyber-footer mt-5 fixed-bottom">
    <div class="container text-center py-1">
        <p class="neon-text mb-1">CryptoBot &copy; 2025</p>
        <div class="social-icons mb-2">
            <a href="https://github.com/Benilsn" target="_blank" class="neon-link me-3">GitHub</a>
            <a href="#" target="_blank" class="neon-link me-3">Discord</a>
            <a href="#" target="_blank" class="neon-link">Contact</a>
        </div>
    </div>
</footer>

{/fragment}